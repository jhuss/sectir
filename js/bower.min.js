!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.TreeModel=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c,d;c=a("mergesort"),d=a("find-insert-index"),b.exports=function(){"use strict";function TreeModel(a){a=a||{},this.config=a,this.config.childrenPropertyName=a.childrenPropertyName||"children",this.config.modelComparatorFn=a.modelComparatorFn}function a(a,b){return b.parent=a,a.children.push(b),b}function b(a,b){this.config=a,this.model=b,this.children=[]}function e(){var a={};if(1===arguments.length?a.fn=arguments[0]:2===arguments.length?"function"==typeof arguments[0]?(a.fn=arguments[0],a.ctx=arguments[1]):(a.options=arguments[0],a.fn=arguments[1]):(a.options=arguments[0],a.fn=arguments[1],a.ctx=arguments[2]),a.options=a.options||{},a.options.strategy||(a.options.strategy="pre"),!f[a.options.strategy])throw new Error("Unknown tree walk strategy. Valid strategies are 'pre' [default], 'post' and 'breadth'.");return a}var f;return f={},TreeModel.prototype.parse=function(d){var e,f,g;if(!(d instanceof Object))throw new TypeError("Model must be of type object.");if(g=new b(this.config,d),d[this.config.childrenPropertyName]instanceof Array)for(this.config.modelComparatorFn&&(d[this.config.childrenPropertyName]=c(this.config.modelComparatorFn,d[this.config.childrenPropertyName])),e=0,f=d[this.config.childrenPropertyName].length;f>e;e++)a(g,this.parse(d[this.config.childrenPropertyName][e]));return g},b.prototype.isRoot=function(){return void 0===this.parent},b.prototype.isLeaf=function(){return 0==this.children.length},b.prototype.hasChildren=function(){return this.children.length>0},b.prototype.addChild=function(a){var c;if(!(a instanceof b))throw new TypeError("Child must be of type Node.");return a.parent=this,this.model[this.config.childrenPropertyName]instanceof Array||(this.model[this.config.childrenPropertyName]=[]),this.config.modelComparatorFn?(c=d(this.config.modelComparatorFn,this.model[this.config.childrenPropertyName],a.model),this.model[this.config.childrenPropertyName].splice(c,0,a.model),this.children.splice(c,0,a)):(this.model[this.config.childrenPropertyName].push(a.model),this.children.push(a)),a},b.prototype.getPath=function(){var a=[];return function b(c){a.unshift(c),c.isRoot()||b(c.parent)}(this),a},b.prototype.walk=function(){var a;a=e.apply(this,arguments),f[a.options.strategy].call(this,a.fn,a.ctx)},f.pre=function g(a,b){var c,d,e;for(e=a.call(b,this),c=0,d=this.children.length;d>c;c++){if(e===!1)return!1;e=g.call(this.children[c],a,b)}return e},f.post=function h(a,b){var c,d,e;for(c=0,d=this.children.length;d>c;c++)if(e=h.call(this.children[c],a,b),e===!1)return!1;return e=a.call(b,this)},f.breadth=function(a,b){var c=[this];!function d(){var e,f,g;if(0!==c.length){for(g=c.shift(),e=0,f=g.children.length;f>e;e++)c.push(g.children[e]);a.call(b,g)!==!1&&d()}}()},b.prototype.all=function(){var a,b=[];return a=e.apply(this,arguments),f[a.options.strategy].call(this,function(c){a.fn.call(a.ctx,c)&&b.push(c)},a.ctx),b},b.prototype.first=function(){var a,b;return a=e.apply(this,arguments),f[a.options.strategy].call(this,function(c){return a.fn.call(a.ctx,c)?(b=c,!1):void 0},a.ctx),b},b.prototype.leaves=function(){return this.all(function(a){return a.isLeaf()})},b.prototype.drop=function(){var a;return this.isRoot()||(a=this.parent.children.indexOf(this),this.parent.children.splice(a,1),this.parent.model[this.config.childrenPropertyName].splice(a,1),this.parent=void 0,delete this.parent),this},TreeModel}()},{"find-insert-index":2,mergesort:3}],2:[function(a,b){b.exports=function(){"use strict";function a(a,b,c){var d,e;for(d=0,e=b.length;e>d&&!(a(b[d],c)>0);d++);return d}return a}()},{}],3:[function(a,b){b.exports=function(){"use strict";function a(c,d){var e,f,g=d.length;return g>=2?(e=d.slice(0,g/2),f=d.slice(g/2,g),b(c,a(c,e),a(c,f))):d.slice()}function b(a,b,c){for(var d=[],e=b.length,f=c.length;e>0&&f>0;)a(b[0],c[0])<=0?(d.push(b.shift()),e--):(d.push(c.shift()),f--);return e>0?d.push.apply(d,b):d.push.apply(d,c),d}return a}()},{}]},{},[1])(1)}),function(){angular.module("sectirTableModule.table",["sectirTableModule.treeFactory"]).directive("sectirTable",["sectirTreeFactory","$compile",function(a,b){var c;return c={namespace:"default",deletefieldlabel:"Delete",debugmodel:!1,deletelabel:"Delete",typefield:"type",titlefield:"name",optionsfield:"options",addlabel:"Add",addfieldlabel:"Add"},{restrict:"EA",scope:{namespace:"=?",tabledata:"=",titlefield:"=?",deletelabel:"=?",deletefieldlabel:"=?",addfieldlabel:"=?",addlabel:"=?",typefield:"=?",debugmodel:"=?",optionsfield:"=?"},controller:["$scope",function(b){return this.getLeafs=function(){return a.getLeafs,b.namespace}}],link:function(d,e){var f,g;return f=function(){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;for(l in c)y=c[l],angular.isDefined(d[l])||(d[l]=y);for(a.addTree(d.tabledata,d.namespace),o=a.getRows(d.namespace),m=e.find("table"),angular.isElement(m)&&m.remove(),s=angular.element("<table>"),s.addClass("sectir-table"),j=!0,v=[],z=0,D=o.length;D>z;z++){for(n=o[z],k=[],u=angular.element("<tr>"),u.addClass("sectir-table-header"),A=0,E=n.length;E>A;A++)i=n[A],f=angular.element("<th>"),f.text(i.model[d.titlefield]),f.addClass("sectir-header"),f.attr("colspan",a.getNumberLeafsFromNode(i.model.id,d.namespace)),p=function(){var b;return b=a.hasChildrenById(i.model.id,d.namespace),b?1:a.getNodeLevelsFromMax(i.model.id,d.namespace)+1}(),f.attr("rowspan",p),k.push(f);for(j&&(j=!1,w=a.getTreeHeight(d.namespace),f=angular.element("<th>"),f.addClass("sectir-delete"),r=angular.element("<span>"),r.text("{{ deletelabel }}"),f.append(r),f.attr("colspan",1),f.attr("rowspan",w),g=angular.element("<th>"),g.addClass("sectir-add"),q=angular.element("<span>"),q.text("{{ addlabel }}"),g.append(q),g.attr("colspan",1),g.attr("rowspan",w),k.push(g),k.push(f)),B=0,F=k.length;F>B;B++)x=k[B],u.append(x);v.push(u)}for(C=0,G=v.length;G>C;C++)x=v[C],s.append(x);return d.answersObject={},t=function(){var b,c,e,f,g,h,i,j,k,m,n,o,p,q,r,s,t,u;for(j=a.getLeafs(d.namespace),p=angular.element("<tr>"),p.attr("ng-repeat","ans in answersObject.values"),p.addClass("sectir-ans-row"),m=function(a){var b;return b="answersObject.values[$index]",b+="["+a+"]"},g=0,k=a.getLeafs(d.namespace,"pre"),u=0,t=k.length;t>u;u++){if(i=k[u],e=angular.element("<th>"),e.addClass("sectir-answer"),o=m(i.model.id),s=angular.isDefined(i.model[d.typefield]),h=angular.element(s&&"select"===i.model[d.typefield]?"<select>":"<input>"),h.attr("ng-model",o),s&&h.attr("type",i.model[d.typefield]),angular.isDefined){i.model[d.optionsfield],n=i.model[d.optionsfield];for(l in n)y=n[l],h.attr(l,y)}d.debugmodel&&(f=angular.element("<i>"),f.addClass("sectir-debug-model"),f.text("{{ "+o+" }}")),e.append(h),d.debugmodel&&e.append(f),p.append(e),g++}return c=angular.element("<th>"),c.addClass("sectir-button-delete"),r=angular.element("<span>"),r.attr("ng-click","deleteAnswer($index)"),r.text("{{ deletefieldlabel }}"),c.append(r),b=angular.element("<th>"),b.addClass("sectir-button-add"),q=angular.element("<span>"),q.attr("ng-click","addAnswer()"),q.text("{{ addfieldlabel }}"),b.append(q),p.append(b),p.append(c),p}(),h=t,s.append(h),b(s)(d),e.append(s),d.answersObject.values=[],d.addAnswer=function(){return d.answersObject.values.push({})},d.deleteAnswer=function(a){return d.answersObject.values.splice(a,1),d.answersObject.values.length<1?d.addAnswer():void 0},d.addAnswer()},g=function(){return[d.namespace,d.tabledata]},f(),d.$watch(g,f,!0)}}}])}.call(this),function(){angular.module("sectirTableModule.treeFactory",[]).factory("sectirTreeFactory",function(){var a;return new(a=function(){function a(){this.trees={},this.maxHeights={},this.nodesById={}}return a.prototype.reset=function(){return this.trees={},this.maxHeights={},this.nodesById={}},a.prototype.addTree=function(a,b){var c;null==b&&(b="default"),c=new TreeModel,this.trees[b]=c.parse(a),this.maxHeights[b]=void 0,this.nodesById[b]={}},a.prototype.getTreeHeight=function(a){var b;return null==a&&(a="default"),null!=this.maxHeights[a]?this.maxHeights[a]:(b=0,this.trees[a].walk(function(a){var c;c=a.getPath().length,c>b&&(b=c)}),this.maxHeights[a]=b)},a.prototype.getNodeHeightById=function(a,b){var c;return null==b&&(b="default"),c=this.getNodeById(a,b),c?c.getPath().length:!1},a.prototype.getNodeById=function(a,b){var c,d;return null==b&&(b="default"),null==this.trees[b]?!1:null!=this.nodesById[b][a]?this.nodesById[b][a]:(a=String(a),c=!1,null!=(d=this.trees[b])&&d.walk(function(b){var d;return d=String(b.model.id),d===a?(c=b,!1):void 0}),this.nodesById[b][a]=c)},a.prototype.hasChildren=function(a){return null!=a.children&&a.children.length>0},a.prototype.hasChildrenById=function(a,b){return null==b&&(b="default"),this.hasChildren(this.getNodeById(a,b))},a.prototype.getLeafs=function(a,b){var c,d,e;return null==a&&(a="default"),null==b&&(b="breadth"),e={strategy:b},d=this,c=null!=this.trees[a]?this.trees[a].all(e,function(a){return!d.hasChildren(a)}):!1},a.prototype.getRows=function(a){var b,c,d,e;return null==a&&(a="default"),e={strategy:"breadth"},c=[],b=-1,d=this,this.trees[a].walk(e,function(e){var f;f=d.getNodeHeightById(e.model.id,a),f!==b&&(c.push([]),b=f),c[b-1].push(e)}),c},a.prototype.getNodeLevelsFromMax=function(a,b){var c;return null==b&&(b="default"),c=this.getNodeById(a,b),c===!1?!1:this.getTreeHeight(b)-c.getPath().length},a.prototype.getNumberLeafsFromNode=function(a,b){var c,d,e;return null==b&&(b="default"),c=this.getNodeById(a,b),c===!1?!1:(d=0,e=this,c.walk(function(a){e.hasChildren(a)||d++}),d)},a}())})}.call(this),function(){angular.module("sectirTableModule",["sectirTableModule.table"])}.call(this);